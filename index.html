<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Manager</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Calibri', sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;
        }

        /* Login Styles */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            width: 400px;
            border: 2px solid #ccc;
        }

        .login-box h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
            font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
        }

        .password-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: #000080;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 20px;
            cursor: pointer;
            margin-bottom: 10px;
            font-family: 'Calibri', sans-serif;
        }

        .change-pass-btn {
            width: 100%;
            padding: 12px;
            background-color: #006400;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 20px;
            cursor: pointer;
            font-family: 'Calibri', sans-serif;
        }

        .login-btn:hover {
            background-color: #000060;
        }

        .change-pass-btn:hover {
            background-color: #004d00;
        }

        /* Header Styles */
        .app-header {
            background-color: #000080;
            color: white;
            text-align: center;
            padding: 20px;
            border-bottom: 3px solid white;
        }

        .app-header h1 {
            font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
            font-size: 40px;
            font-weight: bold;
            display: inline-block;
            border: 2px solid white;
            padding: 10px 40px;
            border-radius: 5px;
        }

        /* Tab Bar Styles */
        .tab-bar {
            display: flex;
            background-color: #2C3E50;
            border-bottom: 2px solid #ddd;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background-color: #2C3E50;
            color: white;
            border: none;
            font-size: 20px;
            font-weight: bold;
            font-family: 'Calibri', sans-serif;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .tab-btn:hover {
            background-color: #34495E;
        }

        .tab-btn.active {
            background-color: #1A252F;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .tab-content.active {
            display: block;
        }

        /* Dashboard Styles */
        .grand-total-box {
            background-color: #E3F2FD;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .grand-total-box h2 {
            font-family: 'Calibri', sans-serif;
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
        }

        .grand-total-box .amount {
            font-family: 'Calibri', sans-serif;
            font-size: 50px;
            font-weight: bold;
            color: #C0392B;
        }

        .banks-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .bank-box {
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .bank-box h3 {
            font-family: 'Calibri', sans-serif;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .bank-box .amount {
            font-family: 'Calibri', sans-serif;
            font-size: 20px;
            font-weight: bold;
        }

        .bank-box.mbl-dmc {
            background-color: #90EE90;
        }
        .bank-box.mbl-dmc h3 { color: #006400; }
        .bank-box.mbl-dmc .amount { color: #006400; }

        .bank-box.mbl-kc {
            background-color: #ADD8E6;
        }
        .bank-box.mbl-kc h3 { color: #000080; }
        .bank-box.mbl-kc .amount { color: #000080; }

        .bank-box.ubl-dmc {
            background-color: #D8BFD8;
        }
        .bank-box.ubl-dmc h3 { color: #4B0082; }
        .bank-box.ubl-dmc .amount { color: #4B0082; }

        /* Chart Container */
        .chart-container {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .chart-header {
            background-color: #2980B9;
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 40px;
            font-weight: bold;
            font-family: 'Calibri', sans-serif;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* Opening Balance Styles */
        .opening-balance-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .balance-input-group {
            margin-bottom: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .balance-input-group label {
            display: block;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .balance-input-group input {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }

        .button-group {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        .btn-navy {
            flex: 1;
            padding: 12px;
            background-color: #000080;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            font-family: 'Calibri', sans-serif;
        }

        .btn-green {
            flex: 1;
            padding: 12px;
            background-color: #008000;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            font-family: 'Calibri', sans-serif;
        }

        /* Transaction Management Styles */
        .tm-dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .tm-box {
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tm-box h3 {
            font-family: 'Calibri', sans-serif;
            font-size: 25px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .tm-box .amount {
            font-family: 'Calibri', sans-serif;
            font-size: 30px;
            font-weight: bold;
        }

        .tm-box.opening-mbl { background-color: #000080; }
        .tm-box.opening-kc { background-color: #006400; }
        .tm-box.opening-ubl { background-color: #8E44AD; }

        .tm-box.current-mbl { background-color: #4169E1; }
        .tm-box.current-kc { background-color: #228B22; }
        .tm-box.current-ubl { background-color: #9B59B6; }

        .section-header {
            background-color: #27AE60;
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 20px;
            font-weight: bold;
            font-family: 'Calibri', sans-serif;
            border-radius: 5px;
            margin: 30px 0 20px 0;
        }

        .data-entry-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .form-group input, .form-group select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        /* NEW: Category Field with Inline Management */
        .category-field-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .category-select-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .category-select-wrapper select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            width: 100%;
        }

        .category-actions {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .btn-cat-add {
            padding: 6px 12px;
            background-color: #27AE60;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }

        .btn-cat-delete {
            padding: 6px 12px;
            background-color: #C0392B;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }

        .btn-cat-add:hover {
            background-color: #229954;
        }

        .btn-cat-delete:hover {
            background-color: #A93226;
        }

        .btn-add-transaction {
            display: block;
            margin: 20px auto 0;
            padding: 12px 40px;
            background-color: #000080;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Calibri', sans-serif;
        }

        .btn-add-transaction:hover {
            background-color: #000060;
        }

        /* Transaction List */
        .transaction-list {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .transaction-table {
            width: 100%;
            border-collapse: collapse;
        }

        .transaction-table th {
            background-color: #34495E;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
            border-bottom: 2px solid #ddd;
        }

        .transaction-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .transaction-table tr:hover {
            background-color: #f9f9f9;
        }

        .debit-amount {
            color: #C0392B;
            font-weight: bold;
        }

        .credit-amount {
            color: #000080;
            font-weight: bold;
        }

        .action-btns {
            display: flex;
            gap: 10px;
        }

        .btn-edit {
            padding: 5px 15px;
            background-color: #F39C12;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .btn-delete {
            padding: 5px 15px;
            background-color: #E74C3C;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        /* Bottom Buttons */
        .bottom-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding: 20px;
            flex-wrap: wrap;
        }

        .btn-save {
            padding: 12px 30px;
            background-color: #006400;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Calibri', sans-serif;
        }

        .btn-export {
            padding: 12px 30px;
            background-color: #000080;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Calibri', sans-serif;
        }

        .btn-import {
            padding: 12px 30px;
            background-color: #E67E22;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Calibri', sans-serif;
        }

        .btn-clear-all {
            padding: 12px 30px;
            background-color: #C0392B;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Calibri', sans-serif;
        }

        .btn-clear-all:hover {
            background-color: #A93226;
        }

        .hidden-file-input {
            display: none;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 400px;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-content input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
        }

        .modal-buttons button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn-confirm {
            background-color: #000080;
            color: white;
        }

        .btn-cancel {
            background-color: #ccc;
            color: #333;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 20px;
            background: #C0392B;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .app-container {
            position: relative;
        }

        /* Category Add Modal */
        .category-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2500;
            justify-content: center;
            align-items: center;
        }

        .category-modal.active {
            display: flex;
        }

        .cat-modal-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 350px;
            text-align: center;
        }

        .cat-modal-content h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .cat-modal-content input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .cat-modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .cat-modal-buttons button {
            padding: 8px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-cat-save {
            background-color: #27AE60;
            color: white;
        }

        .btn-cat-cancel {
            background-color: #95A5A6;
            color: white;
        }

        /* Clear All Confirmation Modal */
        .clear-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .clear-modal.active {
            display: flex;
        }

        .clear-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            max-width: 450px;
            border: 3px solid #C0392B;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .clear-box h3 {
            color: #C0392B;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .clear-box p {
            margin-bottom: 20px;
            font-size: 16px;
            color: #333;
            line-height: 1.5;
        }

        .clear-btns {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn-yes-clear {
            padding: 10px 30px;
            background-color: #C0392B;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .btn-no-clear {
            padding: 10px 30px;
            background-color: #7F8C8D;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <!-- Login Overlay -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <h2>Login</h2>
            <input type="password" id="passwordInput" class="password-input" placeholder="Enter Password">
            <button class="login-btn" onclick="login()">Login</button>
            <button class="change-pass-btn" onclick="showChangePassword()">Change Password</button>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <h3>Change Password</h3>
            <input type="password" id="oldPassword" placeholder="Current Password">
            <input type="password" id="newPassword" placeholder="New Password">
            <input type="password" id="confirmPassword" placeholder="Confirm New Password">
            <div class="modal-buttons">
                <button class="btn-confirm" onclick="changePassword()">Change</button>
                <button class="btn-cancel" onclick="closeChangePassword()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="addCategoryModal" class="category-modal">
        <div class="cat-modal-content">
            <h3>Add New Category</h3>
            <input type="text" id="newCategoryInput" placeholder="Enter Category Name">
            <div class="cat-modal-buttons">
                <button class="btn-cat-save" onclick="saveNewCategory()">Add</button>
                <button class="btn-cat-cancel" onclick="closeAddCategoryModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Clear All Confirmation Modal -->
    <div id="clearAllModal" class="clear-modal">
        <div class="clear-box">
            <h3>⚠️ Warning!</h3>
            <p>Are you sure you want to delete ALL transactions?<br>This action cannot be undone!</p>
            <div class="clear-btns">
                <button class="btn-yes-clear" onclick="confirmClearAll()">Yes, Clear All</button>
                <button class="btn-no-clear" onclick="closeClearModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="app-container" id="appContainer" style="display: none;">
        <button class="logout-btn" onclick="logout()">Logout</button>
        
        <!-- Header -->
        <header class="app-header">
            <h1>Expense Manager</h1>
        </header>

        <!-- Tab Bar -->
        <nav class="tab-bar">
            <button class="tab-btn active" onclick="openTab('dashboard')">Dashboard</button>
            <button class="tab-btn" onclick="openTab('openingBalance')">Opening Balance</button>
            <button class="tab-btn" onclick="openTab('transactionManagement')">Transaction Management</button>
        </nav>

        <!-- Tab 1: Dashboard -->
        <div id="dashboard" class="tab-content active">
            <div class="grand-total-box">
                <h2>Grand Total of all 3 banks</h2>
                <div class="amount" id="grandTotal">PKR 0.00</div>
            </div>

            <div class="banks-container">
                <div class="bank-box mbl-dmc">
                    <h3>Current Balance of MBL-DMC</h3>
                    <div class="amount" id="dashboardMblDmc">PKR 0.00</div>
                </div>
                <div class="bank-box mbl-kc">
                    <h3>Current Balance of MBL-KC</h3>
                    <div class="amount" id="dashboardMblKc">PKR 0.00</div>
                </div>
                <div class="bank-box ubl-dmc">
                    <h3>Current Balance of UBL-DMC</h3>
                    <div class="amount" id="dashboardUblDmc">PKR 0.00</div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-header">Bar Chart</div>
                <div class="chart-wrapper">
                    <canvas id="balanceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tab 2: Opening Balance -->
        <div id="openingBalance" class="tab-content">
            <div class="opening-balance-container">
                <div class="balance-input-group">
                    <label>Opening Balance of MBL-DMC</label>
                    <input type="number" id="openingMblDmc" placeholder="Enter Amount">
                </div>
                <div class="balance-input-group">
                    <label>Opening Balance of MBL-KC</label>
                    <input type="number" id="openingMblKc" placeholder="Enter Amount">
                </div>
                <div class="balance-input-group">
                    <label>Opening Balance of UBL-DMC</label>
                    <input type="number" id="openingUblDmc" placeholder="Enter Amount">
                </div>
                <div class="button-group">
                    <button class="btn-navy" onclick="addOpeningBalance()">Add Amount</button>
                    <button class="btn-green" onclick="resetOpeningBalance()">Reset Amount</button>
                </div>
            </div>
        </div>

        <!-- Tab 3: Transaction Management -->
        <div id="transactionManagement" class="tab-content">
            <!-- 6 Boxes Dashboard -->
            <div class="tm-dashboard">
                <div class="tm-box opening-mbl">
                    <h3>MBL-DMC</h3>
                    <div>Opening Balance</div>
                    <div class="amount" id="tmOpeningMblDmc">PKR 0.00</div>
                </div>
                <div class="tm-box opening-kc">
                    <h3>MBL-KC</h3>
                    <div>Opening Balance</div>
                    <div class="amount" id="tmOpeningMblKc">PKR 0.00</div>
                </div>
                <div class="tm-box opening-ubl">
                    <h3>UBL-DMC</h3>
                    <div>Opening Balance</div>
                    <div class="amount" id="tmOpeningUblDmc">PKR 0.00</div>
                </div>
                <div class="tm-box current-mbl">
                    <h3>MBL-DMC</h3>
                    <div>Current Balance</div>
                    <div class="amount" id="tmCurrentMblDmc">PKR 0.00</div>
                </div>
                <div class="tm-box current-kc">
                    <h3>MBL-KC</h3>
                    <div>Current Balance</div>
                    <div class="amount" id="tmCurrentMblKc">PKR 0.00</div>
                </div>
                <div class="tm-box current-ubl">
                    <h3>UBL-DMC</h3>
                    <div>Current Balance</div>
                    <div class="amount" id="tmCurrentUblDmc">PKR 0.00</div>
                </div>
            </div>

            <!-- Transaction Data Entry Form -->
            <div class="section-header">Transaction Data Entry Form</div>
            <div class="data-entry-form">
                <input type="hidden" id="editTransactionId">
                <div class="form-row">
                    <div class="form-group">
                        <label>Date (DD-MM-YYYY)</label>
                        <input type="text" id="transDate" placeholder="DD-MM-YYYY">
                    </div>
                    <div class="form-group">
                        <label>Bank</label>
                        <select id="transBank">
                            <option value="MBL-DMC">MBL-DMC</option>
                            <option value="MBL-KC">MBL-KC</option>
                            <option value="UBL-DMC">UBL-DMC</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" id="transDescription" placeholder="Enter Description">
                    </div>
                    
                    <!-- NEW: Category with Inline Add/Delete -->
                    <div class="form-group">
                        <label>Category</label>
                        <div class="category-field-wrapper">
                            <div class="category-select-wrapper">
                                <select id="transCategory">
                                    <!-- Categories loaded dynamically -->
                                </select>
                                <div class="category-actions">
                                    <button class="btn-cat-add" onclick="showAddCategoryModal()">+ Add</button>
                                    <button class="btn-cat-delete" onclick="deleteSelectedCategory()">- Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Debit</label>
                        <input type="number" id="transDebit" placeholder="0.00" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Credit</label>
                        <input type="number" id="transCredit" placeholder="0.00" min="0" step="0.01">
                    </div>
                </div>

                <button class="btn-add-transaction" onclick="addTransaction()">Add Transaction</button>
            </div>

            <!-- List of Transaction Entries -->
            <div class="section-header">List of Transaction Entries</div>
            <div class="transaction-list">
                <table class="transaction-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Bank</th>
                            <th>Description</th>
                            <th>Category</th>
                            <th>Debit</th>
                            <th>Credit</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="transactionTableBody">
                        <!-- Transactions will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Bottom Buttons -->
            <div class="bottom-buttons">
                <button class="btn-save" onclick="saveData()">Save Transaction</button>
                <button class="btn-export" onclick="exportToExcel()">Export to Excel</button>
                <button class="btn-import" onclick="document.getElementById('importFile').click()">Import from Excel</button>
                <input type="file" id="importFile" class="hidden-file-input" accept=".xlsx,.xls" onchange="importFromExcel(event)">
                <button class="btn-clear-all" onclick="showClearAllModal()">Clear All</button>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let appData = {
            password: 'Pwd@0487',
            openingBalances: {
                'MBL-DMC': 0,
                'MBL-KC': 0,
                'UBL-DMC': 0
            },
            transactions: [],
            categories: ['Office Expenses', 'Travel', 'Utilities', 'Salaries', 'Miscellaneous']
        };

        let balanceChart = null;

        // Initialize
        window.onload = function() {
            loadData();
            updateDashboard();
            updateTransactionManagement();
            renderCategoryDropdown();
        };

        // Login Functions
        function login() {
            const password = document.getElementById('passwordInput').value;
            if (password === appData.password) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                updateDashboard();
                updateTransactionManagement();
            } else {
                alert('Incorrect Password!');
            }
        }

        function logout() {
            document.getElementById('loginOverlay').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('passwordInput').value = '';
        }

        function showChangePassword() {
            document.getElementById('changePasswordModal').classList.add('active');
        }

        function closeChangePassword() {
            document.getElementById('changePasswordModal').classList.remove('active');
            document.getElementById('oldPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        function changePassword() {
            const oldPass = document.getElementById('oldPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;

            if (oldPass !== appData.password) {
                alert('Current password is incorrect!');
                return;
            }

            if (newPass !== confirmPass) {
                alert('New passwords do not match!');
                return;
            }

            if (newPass.length < 4) {
                alert('Password must be at least 4 characters long!');
                return;
            }

            appData.password = newPass;
            saveData();
            alert('Password changed successfully!');
            closeChangePassword();
        }

        // Tab Navigation
        function openTab(tabName) {
            const tabs = document.getElementsByClassName('tab-content');
            for (let tab of tabs) {
                tab.classList.remove('active');
            }

            const buttons = document.getElementsByClassName('tab-btn');
            for (let btn of buttons) {
                btn.classList.remove('active');
            }

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'transactionManagement') {
                updateTransactionManagement();
            }
        }

        // Opening Balance Functions
        function addOpeningBalance() {
            const mblDmc = parseFloat(document.getElementById('openingMblDmc').value) || 0;
            const mblKc = parseFloat(document.getElementById('openingMblKc').value) || 0;
            const ublDmc = parseFloat(document.getElementById('openingUblDmc').value) || 0;

            appData.openingBalances['MBL-DMC'] = mblDmc;
            appData.openingBalances['MBL-KC'] = mblKc;
            appData.openingBalances['UBL-DMC'] = ublDmc;

            saveData();
            alert('Opening balances added successfully!');
            updateDashboard();
            updateTransactionManagement();
        }

        function resetOpeningBalance() {
            if (confirm('Are you sure you want to reset all opening balances to zero?')) {
                appData.openingBalances = {
                    'MBL-DMC': 0,
                    'MBL-KC': 0,
                    'UBL-DMC': 0
                };
                document.getElementById('openingMblDmc').value = '';
                document.getElementById('openingMblKc').value = '';
                document.getElementById('openingUblDmc').value = '';
                saveData();
                updateDashboard();
                updateTransactionManagement();
            }
        }

        // Category Management - NEW INLINE SYSTEM
        function renderCategoryDropdown() {
            const select = document.getElementById('transCategory');
            select.innerHTML = '';
            
            // Sort categories alphabetically
            appData.categories.sort();
            
            appData.categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
        }

        function showAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.add('active');
            document.getElementById('newCategoryInput').value = '';
            document.getElementById('newCategoryInput').focus();
        }

        function closeAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.remove('active');
        }

        function saveNewCategory() {
            const input = document.getElementById('newCategoryInput');
            const newCat = input.value.trim();
            
            if (!newCat) {
                alert('Please enter a category name!');
                return;
            }
            
            if (appData.categories.includes(newCat)) {
                alert('This category already exists!');
                return;
            }

            appData.categories.push(newCat);
            saveData();
            renderCategoryDropdown();
            
            // Select the newly added category
            document.getElementById('transCategory').value = newCat;
            
            closeAddCategoryModal();
        }

        function deleteSelectedCategory() {
            const select = document.getElementById('transCategory');
            const selectedCat = select.value;
            
            if (!selectedCat) {
                alert('Please select a category to delete!');
                return;
            }
            
            if (appData.categories.length <= 1) {
                alert('Cannot delete the last category! At least one category must remain.');
                return;
            }

            // Check if category is used in any transaction
            const isUsed = appData.transactions.some(t => t.category === selectedCat);
            
            let confirmMsg = `Are you sure you want to delete "${selectedCat}"?`;
            if (isUsed) {
                confirmMsg += '\n\nWarning: This category is used in existing transactions. Those transactions will keep this category name but it won\'t be available for new transactions.';
            }

            if (confirm(confirmMsg)) {
                const index = appData.categories.indexOf(selectedCat);
                if (index > -1) {
                    appData.categories.splice(index, 1);
                    saveData();
                    renderCategoryDropdown();
                }
            }
        }

        // Allow Enter key in category modal
        document.getElementById('newCategoryInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') saveNewCategory();
        });

        // Transaction Management
        function addTransaction() {
            const id = document.getElementById('editTransactionId').value;
            const date = document.getElementById('transDate').value;
            const bank = document.getElementById('transBank').value;
            const description = document.getElementById('transDescription').value;
            const category = document.getElementById('transCategory').value;
            const debit = parseFloat(document.getElementById('transDebit').value) || 0;
            const credit = parseFloat(document.getElementById('transCredit').value) || 0;

            const dateRegex = /^\d{2}-\d{2}-\d{4}$/;
            if (!dateRegex.test(date)) {
                alert('Please enter date in DD-MM-YYYY format!');
                return;
            }

            if (!description) {
                alert('Please enter description!');
                return;
            }

            if (debit === 0 && credit === 0) {
                alert('Please enter either debit or credit amount!');
                return;
            }

            const transaction = {
                id: id || Date.now().toString(),
                date: date,
                bank: bank,
                description: description,
                category: category,
                debit: debit,
                credit: credit
            };

            if (id) {
                const index = appData.transactions.findIndex(t => t.id === id);
                if (index !== -1) {
                    appData.transactions[index] = transaction;
                }
                document.getElementById('editTransactionId').value = '';
            } else {
                appData.transactions.push(transaction);
            }

            appData.transactions.sort((a, b) => {
                const dateA = parseDate(a.date);
                const dateB = parseDate(b.date);
                return dateB - dateA;
            });

            clearTransactionForm();
            updateTransactionManagement();
            updateDashboard();
            saveData();
        }

        function parseDate(dateStr) {
            const parts = dateStr.split('-');
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }

        function clearTransactionForm() {
            document.getElementById('transDate').value = '';
            document.getElementById('transDescription').value = '';
            document.getElementById('transDebit').value = '';
            document.getElementById('transCredit').value = '';
            document.getElementById('editTransactionId').value = '';
            // Keep the last selected category or reset to first
            if (appData.categories.length > 0) {
                document.getElementById('transCategory').selectedIndex = 0;
            }
        }

        function editTransaction(id) {
            const trans = appData.transactions.find(t => t.id === id);
            if (trans) {
                document.getElementById('editTransactionId').value = trans.id;
                document.getElementById('transDate').value = trans.date;
                document.getElementById('transBank').value = trans.bank;
                document.getElementById('transDescription').value = trans.description;
                document.getElementById('transCategory').value = trans.category;
                document.getElementById('transDebit').value = trans.debit || '';
                document.getElementById('transCredit').value = trans.credit || '';
            }
        }

        function deleteTransaction(id) {
            if (confirm('Are you sure you want to delete this transaction?')) {
                appData.transactions = appData.transactions.filter(t => t.id !== id);
                updateTransactionManagement();
                updateDashboard();
                saveData();
            }
        }

        // Clear All Functions
        function showClearAllModal() {
            document.getElementById('clearAllModal').classList.add('active');
        }

        function closeClearModal() {
            document.getElementById('clearAllModal').classList.remove('active');
        }

        function confirmClearAll() {
            appData.transactions = [];
            saveData();
            updateTransactionManagement();
            updateDashboard();
            closeClearModal();
            alert('All transactions have been cleared successfully!');
        }

        // Calculation Functions
        function calculateCurrentBalance(bank) {
            const opening = appData.openingBalances[bank] || 0;
            const bankTransactions = appData.transactions.filter(t => t.bank === bank);
            
            let totalDebit = 0;
            let totalCredit = 0;
            
            bankTransactions.forEach(t => {
                totalDebit += t.debit || 0;
                totalCredit += t.credit || 0;
            });
            
            return opening - totalDebit + totalCredit;
        }

        function formatCurrency(amount) {
            return 'PKR ' + amount.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // Update UI Functions
        function updateDashboard() {
            const mblDmcBalance = calculateCurrentBalance('MBL-DMC');
            const mblKcBalance = calculateCurrentBalance('MBL-KC');
            const ublDmcBalance = calculateCurrentBalance('UBL-DMC');
            
            const grandTotal = mblDmcBalance + mblKcBalance + ublDmcBalance;

            document.getElementById('grandTotal').textContent = formatCurrency(grandTotal);
            document.getElementById('dashboardMblDmc').textContent = formatCurrency(mblDmcBalance);
            document.getElementById('dashboardMblKc').textContent = formatCurrency(mblKcBalance);
            document.getElementById('dashboardUblDmc').textContent = formatCurrency(ublDmcBalance);

            updateChart([mblDmcBalance, mblKcBalance, ublDmcBalance]);
        }

        function updateChart(balances) {
            const ctx = document.getElementById('balanceChart').getContext('2d');
            
            if (balanceChart) {
                balanceChart.destroy();
            }

            balanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['MBL-DMC', 'MBL-KC', 'UBL-DMC'],
                    datasets: [{
                        label: 'Current Balance',
                        data: balances,
                        backgroundColor: [
                            'rgba(65, 105, 225, 0.7)',
                            'rgba(144, 238, 144, 0.7)',
                            'rgba(142, 68, 173, 0.7)'
                        ],
                        borderColor: [
                            'rgba(65, 105, 225, 1)',
                            'rgba(144, 238, 144, 1)',
                            'rgba(142, 68, 173, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'PKR ' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateTransactionManagement() {
            document.getElementById('tmOpeningMblDmc').textContent = formatCurrency(appData.openingBalances['MBL-DMC'] || 0);
            document.getElementById('tmOpeningMblKc').textContent = formatCurrency(appData.openingBalances['MBL-KC'] || 0);
            document.getElementById('tmOpeningUblDmc').textContent = formatCurrency(appData.openingBalances['UBL-DMC'] || 0);

            document.getElementById('tmCurrentMblDmc').textContent = formatCurrency(calculateCurrentBalance('MBL-DMC'));
            document.getElementById('tmCurrentMblKc').textContent = formatCurrency(calculateCurrentBalance('MBL-KC'));
            document.getElementById('tmCurrentUblDmc').textContent = formatCurrency(calculateCurrentBalance('UBL-DMC'));

            const tbody = document.getElementById('transactionTableBody');
            tbody.innerHTML = '';

            appData.transactions.forEach(trans => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${trans.date}</td>
                    <td>${trans.bank}</td>
                    <td>${trans.description}</td>
                    <td>${trans.category}</td>
                    <td class="${trans.debit > 0 ? 'debit-amount' : ''}">${trans.debit > 0 ? formatCurrency(trans.debit) : '-'}</td>
                    <td class="${trans.credit > 0 ? 'credit-amount' : ''}">${trans.credit > 0 ? formatCurrency(trans.credit) : '-'}</td>
                    <td class="action-btns">
                        <button class="btn-edit" onclick="editTransaction('${trans.id}')">Edit</button>
                        <button class="btn-delete" onclick="deleteTransaction('${trans.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Import/Export Functions
        function exportToExcel() {
            const data = appData.transactions.map(t => ({
                'Date (DD-MM-YYYY)': t.date,
                'Bank': t.bank,
                'Description': t.description,
                'Category': t.category,
                'Debit': t.debit || 0,
                'Credit': t.credit || 0
            }));

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Transactions");
            
            const openingData = [{
                'Bank': 'MBL-DMC',
                'Opening Balance': appData.openingBalances['MBL-DMC'] || 0
            }, {
                'Bank': 'MBL-KC',
                'Opening Balance': appData.openingBalances['MBL-KC'] || 0
            }, {
                'Bank': 'UBL-DMC',
                'Opening Balance': appData.openingBalances['UBL-DMC'] || 0
            }];
            
            const ws2 = XLSX.utils.json_to_sheet(openingData);
            XLSX.utils.book_append_sheet(wb, ws2, "Opening Balances");

            XLSX.writeFile(wb, "Expense_Report.xlsx");
        }

        function importFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                    jsonData.forEach(row => {
                        const date = row['Date (DD-MM-YYYY)'] || row['Date'] || '';
                        const bank = row['Bank'] || '';
                        const description = row['Description'] || '';
                        const category = row['Category'] || 'Miscellaneous';
                        const debit = parseFloat(row['Debit']) || 0;
                        const credit = parseFloat(row['Credit']) || 0;

                        if (date && bank && description && ['MBL-DMC', 'MBL-KC', 'UBL-DMC'].includes(bank)) {
                            if (!appData.categories.includes(category)) {
                                appData.categories.push(category);
                            }

                            appData.transactions.push({
                                id: Date.now().toString() + Math.random().toString(),
                                date: date.toString(),
                                bank: bank,
                                description: description,
                                category: category,
                                debit: debit,
                                credit: credit
                            });
                        }
                    });

                    appData.transactions.sort((a, b) => {
                        const dateA = parseDate(a.date);
                        const dateB = parseDate(b.date);
                        return dateB - dateA;
                    });

                    saveData();
                    updateTransactionManagement();
                    updateDashboard();
                    renderCategoryDropdown();
                    alert('Data imported successfully!');
                } catch (error) {
                    alert('Error importing file: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
            event.target.value = '';
        }

        // Local Storage Functions
        function saveData() {
            localStorage.setItem('expenseManagerData', JSON.stringify(appData));
        }

        function loadData() {
            const saved = localStorage.getItem('expenseManagerData');
            if (saved) {
                appData = JSON.parse(saved);
                document.getElementById('openingMblDmc').value = appData.openingBalances['MBL-DMC'] || '';
                document.getElementById('openingMblKc').value = appData.openingBalances['MBL-KC'] || '';
                document.getElementById('openingUblDmc').value = appData.openingBalances['UBL-DMC'] || '';
            }
        }

        // Allow Enter key to login
        document.getElementById('passwordInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') login();
        });
    </script>
</body>
</html>